{"version":3,"file":"index.mjs","sources":["../src/handler.ts","../src/game/Board.ts","../src/game/Game.ts","../src/game/Color.ts","../src/messages.ts","../src/session/Session.ts","../src/session/SessionList.ts","../src/GameInstance.ts","../src/index.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null],"names":["async","handleRequest","request","env","path","URL","url","pathname","Response","UI","headers","startsWith","req","gameName","substr","length","test","gameStub","GAMEINSTANCE","get","idFromName","fetch","handleApiRequest","createEmptyFields","fields","i","push","j","Board","constructor","this","undefined","isMatchingLine","startRow","startCol","deltaRow","deltaCol","color","findWinningColor","row","rowWinner","col","colWinner","diagWinner1","diagWinner2","isFull","reset","getColor","hasColor","setColor","Game","board","nextTurn","_winner","winner","serialized","turn","recalculateWinner","winningColor","isGameOver","canPlaceColor","placeColor","Error","oppositeColor","serialize","createColorMessage","type","createPlayersMessage","playerCount","Session","socket","sendMessage","message","send","JSON","stringify","sendErrorMessage","error","msg","SessionList","sessions","add","session","remove","filter","aSession","broadcast","forEach","s","findWithColor","findNextColor","GameInstance","state","game","blockConcurrencyWhile","loadState","serializedGame","storage","put","createStateMessage","deleteAll","status","webSocketPair","WebSocketPair","client","addEventListener","event","onMessageReceived","onSocketClose","accept","webSocket","data","unvalidatedMessage","parse","e","handleMoveMessage","handleResetMessage","spectator","saveState","console"],"mappings":"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"}